import type {CharacterVoice} from "speech/CharacterVoice";
import {SpeechSystemOption} from "speech/SpeechSystems";
import type {ConfigurableCreator} from "../domain/ConfigurableCreator";
import type {CreatorType} from "../domain/CreatorType";
import type {Message} from "../domain/Message";
import type {Tts} from "../domain/Tts";

/** UI struct for a speech system with its name and all possible options */
class DisplaySpeechSystem {
  name: string;
  options: Array<CharacterVoice>;
  isFree: boolean;

  constructor(name: string, options: Array<CharacterVoice>, isFree: boolean) {
    this.name = name;
    this.options = options;
    this.isFree = isFree;
  }
}

interface SpeechResult {
  filePath: () => string | undefined;
  tts: () => Tts | undefined;
}

/**
 * Represents a test to speech system.
 */
interface SpeechSystem extends CreatorType, ConfigurableCreator {
  name: string; // TODO migrate this to CreatorType#getName() function

  /**
   * Generates spoken audio for message and returns relative filepath to audio from data base dir.
   * @param message
   * @param basename file base name
   */
  speak: (message: string, basename: string) => Promise<SpeechResult>;

  /**
   * Unique key for each option.
   */
  options: () => Array<string>;

  /**
   * Command for inserting a speech of this duration or null if no such command exists
   */
  pauseCommand: (msDuration: number) => string | null;
  currentOption: () => SpeechSystemOption;
  display: DisplaySpeechSystem;

  /**
   * If the message is not generated by a user, return a new Message identical except with
   * the content stripped of any pause command for the SpeechSystem. If the message is
   * from the user, return the message unchanged.
   * @param m the message
   */
  removePauseCommands(m: Message): Message;
}

export {type SpeechSystem, type SpeechResult, DisplaySpeechSystem};
